#
# Assumption here is GNU-make!
#

srcdir = @srcdir@
# VPATH = @srcdir@ ## NO VPATH HERE!
@SET_MAKE@

#prefix=	@prefix@
MANDIR=		${prefix}@mandir@
TOPDIR=		..
S=		$(srcdir)
INSTALL=	@INSTALL@

# SGML/JADE catalog
OJCAT     = /usr/share/sgml/openjade-1.3/catalog
DB2HTML   = jw -c ${OJCAT} -b html -f docbook -o .
DB2MAN    = jw -c ${OJCAT} -b man -f docbook -o .
HTMLFIXUP = ${srcdir}/../doc/manual/html-post-fixup.sh


MAN1=	mailq.1 mailrm.1 newaliases.1 rmail.1 ssl.1 vacation.1 zmailer.1 zmsh.1 mboxpath.1
MAN3=	zmailer.3 authuser.3
MAN5=	aliases.5
MAN8=	errormail.8 hold.8 router.8 scheduler.8 sendmail.8 sm.8 smtp.8 smtpserver.8 manual-expirer.8 expirer.8 mprobe.8 mailbox.8 makedb.8 newdb.8

FRC:
	@echo "make install MANDIR=/your/choice"
	@echo "   default for MANDIR=${MANDIR}"
	@echo "make groff  (or: ps)"
	@echo "make pdf"
	@echo "make html"
	@echo "make clean"

clean:
	rm -rf *~
	if [ "$(srcdir)" != "" ]; then rm -f *.ps *.html; fi

distclean:
	rm -rf *~ vacation.1

depend:

ps groff: $(patsubst %, %.ps, $(MAN1) $(MAN3) $(MAN5) $(MAN8))
pdf:	  $(patsubst %, %.pdf, $(MAN1) $(MAN3) $(MAN5) $(MAN8))
html:	  $(patsubst %, %.html, $(MAN1) $(MAN3) $(MAN5) $(MAN8))
	-rm -f index.html
	sh $(srcdir)/man-index.sh

install:
	if [ ! -d ${MANDIR}/man1 ] ; then mkdir -p ${MANDIR}/man1 ; fi
	if [ ! -d ${MANDIR}/man3 ] ; then mkdir -p ${MANDIR}/man3 ; fi
	if [ ! -d ${MANDIR}/man5 ] ; then mkdir -p ${MANDIR}/man5 ; fi
	if [ ! -d ${MANDIR}/man8 ] ; then mkdir -p ${MANDIR}/man8 ; fi
	$(INSTALL) -m 644 $S/aliases.5	${MANDIR}/man5
	$(INSTALL) -m 644 $S/errormail.8 ${MANDIR}/man8
	$(INSTALL) -m 644 $S/hold.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/mailbox.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/mailq.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/mboxpath.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/mailrm.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/newaliases.1 ${MANDIR}/man1
	$(INSTALL) -m 644 $S/rmail.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/router.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/scheduler.8 ${MANDIR}/man8
	$(INSTALL) -m 644 $S/sendmail.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/sm.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/smtp.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/smtpserver.8 ${MANDIR}/man8
	$(INSTALL) -m 644 $S/mprobe.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/ssl.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/zmailer.1	${MANDIR}/man1
	$(INSTALL) -m 644 $S/zmailer.3	${MANDIR}/man3
	$(INSTALL) -m 644 $S/manual-expirer.8 ${MANDIR}/man8
	$(INSTALL) -m 644 $S/expirer.8	${MANDIR}/man8
	$(INSTALL) -m 644 $S/zmsh.1	${MANDIR}/man1
	$(INSTALL) -m 644 vacation.1	${MANDIR}/man1


mailbox.html: $(srcdir)/mailbox.sgml
	${DB2HTML}   $(srcdir)/mailbox.sgml
	${HTMLFIXUP} mailbox.html

mailbox.8s: $(srcdir)/mailbox.sgml
	${DB2MAN}  $(srcdir)/mailbox.sgml
	#${HTMLFIXUP} mailbox.html

aliases.5.ps: $(srcdir)/aliases.5
	groff -t -man $< > $@
authuser.3.ps: $(srcdir)/authuser.3
	groff -t -man $< > $@
mailq.1.ps: $(srcdir)/mailq.1
	groff -t -man $< > $@
mailrm.1.ps: $(srcdir)/mailrm.1
	groff -t -man $< > $@
newaliases.1.ps: $(srcdir)/newaliases.1
	groff -t -man $< > $@
rmail.1.ps: $(srcdir)/rmail.1
	groff -t -man $< > $@
ssl.1.ps: $(srcdir)/ssl.1
	groff -t -man $< > $@
vacation.1.ps: vacation.1
	groff -t -man $< > $@
zmailer.1.ps: $(srcdir)/zmailer.1
	groff -t -man $< > $@
zmsh.1.ps: $(srcdir)/zmsh.1
	groff -t -man $< > $@
zmailer.3.ps: $(srcdir)/zmailer.3
	groff -t -man $< > $@
errormail.8.ps: $(srcdir)/errormail.8
	groff -t -man $< > $@
hold.8.ps: $(srcdir)/hold.8
	groff -t -man $< > $@
router.8.ps: $(srcdir)/router.8
	groff -t -man $< > $@
scheduler.8.ps: $(srcdir)/scheduler.8
	groff -t -man $< > $@
sendmail.8.ps: $(srcdir)/sendmail.8
	groff -t -man $< > $@
sm.8.ps: $(srcdir)/sm.8
	groff -t -man $< > $@
smtp.8.ps: $(srcdir)/smtp.8
	groff -t -man $< > $@
smtpserver.8.ps: $(srcdir)/smtpserver.8
	groff -t -man $< > $@
manual-expirer.8.ps: $(srcdir)/manual-expirer.8
	groff -t -man $< > $@
expirer.8.ps: $(srcdir)/expirer.8
	groff -t -man $< > $@
mprobe.8.ps: $(srcdir)/mprobe.8
	groff -t -man $< > $@
mailbox.8.ps: $(srcdir)/mailbox.8
	groff -t -man $< > $@
makedb.8.ps: $(srcdir)/makedb.8
	groff -t -man $< > $@
newdb.8.ps: $(srcdir)/newdb.8
	groff -t -man $< > $@
mboxpath.1.ps: $(srcdir)/mboxpath.1
	groff -t -man $< > $@



aliases.5.html: $(srcdir)/aliases.5
	sh $(srcdir)/man-to-html.sh $< > $@
authuser.3.html: $(srcdir)/authuser.3
	sh $(srcdir)/man-to-html.sh $< > $@
mailq.1.html: $(srcdir)/mailq.1
	sh $(srcdir)/man-to-html.sh $< > $@
mailrm.1.html: $(srcdir)/mailrm.1
	sh $(srcdir)/man-to-html.sh $< > $@
newaliases.1.html: $(srcdir)/newaliases.1
	sh $(srcdir)/man-to-html.sh $< > $@
rmail.1.html: $(srcdir)/rmail.1
	sh $(srcdir)/man-to-html.sh $< > $@
ssl.1.html: $(srcdir)/ssl.1
	sh $(srcdir)/man-to-html.sh $< > $@
vacation.1.html: vacation.1
	sh $(srcdir)/man-to-html.sh $< > $@
zmailer.1.html: $(srcdir)/zmailer.1
	sh $(srcdir)/man-to-html.sh $< > $@
zmsh.1.html: $(srcdir)/zmsh.1
	sh $(srcdir)/man-to-html.sh $< > $@
zmailer.3.html: $(srcdir)/zmailer.3
	sh $(srcdir)/man-to-html.sh $< > $@
errormail.8.html: $(srcdir)/errormail.8
	sh $(srcdir)/man-to-html.sh $< > $@
hold.8.html: $(srcdir)/hold.8
	sh $(srcdir)/man-to-html.sh $< > $@
router.8.html: $(srcdir)/router.8
	sh $(srcdir)/man-to-html.sh $< > $@
scheduler.8.html: $(srcdir)/scheduler.8
	sh $(srcdir)/man-to-html.sh $< > $@
sendmail.8.html: $(srcdir)/sendmail.8
	sh $(srcdir)/man-to-html.sh $< > $@
sm.8.html: $(srcdir)/sm.8
	sh $(srcdir)/man-to-html.sh $< > $@
smtp.8.html: $(srcdir)/smtp.8
	sh $(srcdir)/man-to-html.sh $< > $@
smtpserver.8.html: $(srcdir)/smtpserver.8
	sh $(srcdir)/man-to-html.sh $< > $@
manual-expirer.8.html: $(srcdir)/manual-expirer.8
	sh $(srcdir)/man-to-html.sh $< > $@
expirer.8.html: $(srcdir)/expirer.8
	sh $(srcdir)/man-to-html.sh $< > $@
mprobe.8.html: $(srcdir)/mprobe.8
	sh $(srcdir)/man-to-html.sh $< > $@
mailbox.8.html: $(srcdir)/mailbox.8
	sh $(srcdir)/man-to-html.sh $< > $@
makedb.8.html: $(srcdir)/makedb.8
	sh $(srcdir)/man-to-html.sh $< > $@
newdb.8.html: $(srcdir)/newdb.8
	sh $(srcdir)/man-to-html.sh $< > $@
mboxpath.1.html: $(srcdir)/mboxpath.1
	sh $(srcdir)/man-to-html.sh $< > $@



aliases.5.pdf: aliases.5.ps
	ps2pdf $<
authuser.3.pdf: authuser.3.ps
	ps2pdf $<
mailq.1.pdf: mailq.1.ps
	ps2pdf $<
mailrm.1.pdf: mailrm.1.ps
	ps2pdf $<
newaliases.1.pdf: newaliases.1.ps
	ps2pdf $<
rmail.1.pdf: rmail.1.ps
	ps2pdf $<
ssl.1.pdf: ssl.1.ps
	ps2pdf $<
vacation.1.pdf: vacation.1.ps
	ps2pdf $<
zmailer.1.pdf: zmailer.1.ps
	ps2pdf $<
zmsh.1.pdf: zmsh.1.ps
	ps2pdf $<
zmailer.3.pdf: zmailer.3.ps
	ps2pdf $<
errormail.8.pdf: errormail.8.ps
	ps2pdf $<
hold.8.pdf: hold.8.ps
	ps2pdf $<
router.8.pdf: router.8.ps
	ps2pdf $<
scheduler.8.pdf: scheduler.8.ps
	ps2pdf $<
sendmail.8.pdf: sendmail.8.ps
	ps2pdf $<
sm.8.pdf: sm.8.ps
	ps2pdf $<
smtp.8.pdf: smtp.8.ps
	ps2pdf $<
smtpserver.8.pdf: smtpserver.8.ps
	ps2pdf $<
manual-expirer.8.pdf: manual-expirer.8.ps
	ps2pdf $<
expirer.8.pdf: expirer.8.ps
	ps2pdf $<
mprobe.8.pdf: mprobe.8.ps
	ps2pdf $<
mailbox.8.pdf: mailbox.8.ps
	ps2pdf $<
makedb.8.pdf: makedb.8.ps
	ps2pdf $<
newdb.8.pdf: newdb.8.ps
	ps2pdf $<
mboxpath.1.pdf: mboxpath.1.ps
	ps2pdf $<
