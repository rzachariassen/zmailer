#!/bin/sh

#
#  Post-Installation script to complete the installation process.
#
#  - To move into place (conditionally) various prototype files
#  - To fill in configuration information into MAILSHARE/db/
#    files, if nothing in there t0 begin with...
#

# - MAILSHARE/forms/proto       --> MAILSHARE/forms (conditionally)
# - MAILSHARE/proto/*.{conf,cf} --> MAILSHARE/      (conditionally)
# - MAILVAR/db/proto/*          --> MAILVAR/db/     (conditionally)


ZCONFIG=@ZMAILERCFGFILE@
INSTALL="@INSTALL@"
MKDIR="@MKDIR@"

. $ZCONFIG

while [ "$1" != "" ]
do
	echo "post-install.sh: param: $1"
	shift
done

exit 99 # Sorry, not yet!

pwd=`pwd`

if [ ! -d $MAILSHARE/bak ]; then $MKDIR $MAILSHARE/bak ; fi

# ----------------------------
#    MAILSHARE/forms/

cd $MAILSHARE/forms/proto
for x in *
do
    if [ ! -f ../$x ] ; then
	mv $x ..
    else
    fi
done

# ----------------------------
#    MAILSHARE/

cd $MAILSHARE/proto
for x in *
do
    if [ ! -f ../$x ] ; then
	mv $x ..
    else
    fi
done

# ----------------------------
#    MAILVAR/db/

cd $MAILVAR/db/proto
for x in *
do
    if [ ! -f ../$x ] ; then
	mv $x ..
    else
    fi
done

# ----------------------------
#    Database prototypes ???

if [ ! -f $MAILSHARE/proto/router.cf ]; then
  echo "*** Verify  $MAILSHARE/router.cf        file !"
fi
if [ ! -f $MAILSHARE/proto/scheduler.conf ]; then
  echo "*** Verify  $MAILSHARE/scheduler.conf   file !"
fi
if [ ! -f $MAILSHARE/proto/smtpserver.conf ]; then
  echo "*** Verify  $MAILSHARE/smtpserver.conf  file !"
fi
if [ ! -f $MAILSHARE/proto/sm.conf ]; then
  echo "*** Verify  $MAILSHARE/sm.conf  file !"
fi

if [ ! -f $MAILVAR/db/proto/aliases ]; then
  echo "*** Verify  $MAILVAR/db/aliases   file !"
fi
if [ ! -f $MAILVAR/db/proto/localnames ]; then
  echo "*** Verify  $MAILVAR/db/localnames   file !"
fi
if [ ! -f $MAILVAR/db/proto/fqdnaliases ]; then
  echo "*** Verify  $MAILVAR/db/fqdnaliases   file !"
fi
if [ ! -f $MAILVAR/db/proto/routes ]; then
  echo "*** Verify  $MAILVAR/db/routes   file !"
fi
if [ ! -f $MAILVAR/db/proto/smtp-policy.src ]; then
  echo "*** Verify  $MAILVAR/db/smtp-policy.src   file !"
fi
if [ ! -f $MAILVAR/db/proto/smtp-policy.mx ]; then
  echo "*** Verify  $MAILVAR/db/smtp-policy.mx   file !"
fi
if [ ! -f $MAILVAR/db/proto/smtp-policy.relay ]; then
  echo "*** Verify  $MAILVAR/db/smtp-policy.relay   file !"
fi


$MAILBIN/zmailer newdb

$MAILBIN/policy-builder.sh -n

echo "*** "