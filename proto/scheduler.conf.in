#
# Scheduler configuration file
#
# The scheduler reads this file on startup or when it receives a SIGUSR1 signal
#
# Every channel/host combination in recipient addresses will be sifted through
# the clauses matched in this file, picking up parameters until a clause that
# specifies a command.  Everything is free-form with three requirements:
# Clauses (i.e. the channel/host pattern) start at the beginning of a line.
# Clause contents (i.e. the parameters) don't.
# Components are separated by whitespace.
# 
# Within command=" ... " strings, following "variables" are known:
#  $host	message's host
#  $channel	message's channel
#  ${LOGDIR}	ZENV variable LOGDIR (all ZENV variables supported)
#
# NB! For command paths, the "current directory" is MAILBIN/ta
#

#
# Note, there are three kinds of resource-pool limitation parameters
# which control when a given channel+host pair (thread) is NOT taken
# into processing:
#
#  maxta:  (Set in "*/*" clause)
#       GLOBAL parameter limiting the number of transport-agent processes
#       that the scheduler can have running at the same time.
#
#  maxchannel:
#       Selector clause specific value limiting how many transport-agent
#       processes can be running on which the ``channel'' part is the same.
#       You may specify dis-similar values for these as well.  For example
#       you may use value '50' for all your 'smtp' channel entries, except
#       that you want always to guarantee at least five more for your own
#       domain deliveries, and thus have:
#               smtp/*your.domain
#                       maxchannel=55
#       If the sum of all ``maxchannel'' values in different channels exceeds
#       that of ``maxta'', then ``maxta'' value will limit the amount of work
#       done in extreme load situations.
#
#  maxring:
#       This limits the number of parallel transport agents within each
#       selector definition.    This defined the size of the POOL of
#       transport agent processes available to processing the selector
#       clause matching the selector.
#
#  maxthr:
#       This limits the number of parallel transport agents within each
#       *thread*; that is, using higher value than default ``1'' will allow
#       running more than one TA for the jobs at the thread.
#

#
# -------- Some external parameters - name starts from column 0, and -----
# -------- always begins with "PARAM" ------------------------------------

# MAILQv2 authentication database file reference:
# If you define this (like the default is), and the file exists,
# scheduler mailq interface goes to v2 mode.

PARAMauthfile = "@MAILSHARE@/scheduler.auth"


#PARAMmailqsock = "UNIX:/path/to/mailq.sock"
#PARAMmailqsock = "TCP:174"

#
# Default parameter boilerplate, following values are in use in
# all operational channel/host clauses, unless overridden in them..
#
*/*	interval=1m
	idlemax=4m # Max idle for SMTP connections is 5 minutes, don't exceed that!
	#          # (Unless smtp channel becomes a bit smarter on handling it..)
	#
	# expire messages after 3 days without full delivery
	expiry=3d
	# when the scheduler gets to the end of the retry sequence,
	# it starts over at some random point in the middle.  The
	# numbers are factors of the scheduling interval.
	retries="1 1 2 3 5 8 13 21 34"
	# no default limits on simultaneous transport agents or
	# connections to a particular host
	maxchannel=0
	maxring=20
	#
	maxta=250 # OSF/1 has 4096 files per process. Don't overbook :-)
	#
	# skew is maximum number of tries before the retry time is
	# aligned to a standard boundary (seconds modulo interval).
	skew=1
	# default uid/gid of transport agents
	user=root
	group=daemon
	#
	# A flag telling about queue-order..
	#
	ageorder
	overfeed=150
	#
	# Possible nice/setpriority values in case one wants to run
	# the scheduler at higher scheduling priority, than TA programs:
	#
	# "priority" sets ABSOLUTE value, and requires setpriority(2)
	# system call.  "nice" is -- well: nice(2)
	#
	# nice=2
	##priority=0
	#
	# "syspriority"/"sysnice" set the value for the scheduler process
	# itself, and are not inherited from the default boilerplate to
	# other parameter blocks.
	#
	# sysnice=-2
	# syspriority=-2

# Deferred delivery is handled by this transport agent.  Deferrals are low
# priority, but they tend to bunch up.  The 1 channel slot means there will
# be lots of contention, and typical checking intervals will be a bit higher
# than what is specified (due to waiting for a free slot).
hold/*
	interval=5m
	maxchannel=1
	command=hold

# BITNET delivery methods

defrt1/*
	maxchannel=3
	command="sm -c $channel defrt1"

bsmtp3/*
	maxchannel=3
	command="sm -c $channel bsmtp3"

bsmtp3nd/*
	maxchannel=3
	command="sm -c $channel bsmtp3nd"
bsmtp3rfc/*
	maxchannel=3
	command="sm -c $channel bsmtp3"

bsmtp3ndrfc/*
	maxchannel=3
	command="sm -c $channel bsmtp3nd"

#
# Local delivery: files, processes, user mail
#
# Parameterless "local/file*" will get same values, as
# "local/pipe*" immediately following it has !
#
local/file*
local/pipe*
	interval=5m
	idlemax=9m
	# Originally we had 3 hour expiry, but if your local system goes to
	# a fizz (freezes, that is), your local mail may start to bounce
	# before anybody notices anything...
	expiry=3d
	# want 20 channel slots, but only one HOST
	maxchannel=15
	maxring=5
	#
	# Do MIME text/plain; Quoted-Printable -> text/plain; 8BIT
	# conversion on flight!  (Can't use CYRUS, nor PROCMAIL here!)
	command="mailbox -8"

#
# This fallback "local/*" can be used to yield different local
# delivery mechanism -- mailbox / CMU cyrus IMAP server / procmail
#
# The latter two can not do deliveries to explicite files / pipes,
# thus you need the  "local/file*" and "local/pipe*" above.
#

local/*
	interval=5m
	idlemax=9m
	# Originally we had 3 hour expiry, but if your local system goes to
	# a fizz (freezes, that is), your local mail may start to bounce
	# before anybody notices anything...
	expiry=3d
	# want 20 channel slots, but only one HOST
	maxchannel=15
	maxring=5
	#
	# Do MIME text/plain; Quoted-Printable -> text/plain; 8BIT
	# conversion on flight!
	command="mailbox -8"
	# Or with CYRUS server the following might do:
	#command="sm -8c $channel cyrus"
	# Or with PROCMAIL as the local delivery agent:
	#command="sm -8c $channel procm"

# smtpx is a channel where the delivery is done without checking at MXes;
# rather only on A/AAAA (address) entries:
smtpx/*
	maxchannel=90
	maxring=10
	command="smtp -c smtpx -x -s"


# Sometimes we may want to PUNT all out to somewhere without regarding
# on what the routing said:
#
# smtp/*
#	maxchannel=199
#	maxring=5
#	command="smtp -F [192.89.123.25] -l ${LOGDIR}/smtp.punt"

# This is a FAST EXPIRY test case.. Will always cause bounce, btw.
# (those machines are cisco routers, which don't have smtp-servers..)
smtp/*-gw.funet.fi
	maxchannel=0
	maxring=5
	expiry=1m
	interval=15s
	retries="1"
	skew=1
	command="smtp -s" # -l ${LOGDIR}/smtp"

smtp/*.rutgers.edu
	maxchannel=199
	maxring=10
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.edu
	maxchannel=199
	maxring=20
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.com
	maxchannel=199
	maxring=30
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.uk
	maxchannel=199
	maxring=8
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.ca
	maxchannel=199
	maxring=10
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.{se,dk,is,no}
	maxchannel=199
	maxring=20
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.de
	maxchannel=199
	maxring=10
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.gov
	maxchannel=199
	maxring=5
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.mil
	maxchannel=199
	maxring=5
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.net
	maxchannel=199
	maxring=10
	command="smtp -s" # -l ${LOGDIR}/smtp"
smtp/*.org
	maxchannel=199
	maxring=10
	command="smtp -s" # -l ${LOGDIR}/smtp"

# Within FUNET we have a bit longer expiry..
smtp/*funet.fi
	maxchannel=199
	maxring=9
	# maxta=2
	interval=10m
	retries="1 1 2 3 5 8 13 21 34"
	skew=1
	# Do FORCED MIME-decoding into C-T-E: 8BIT
	command="smtp -8sl ${LOGDIR}/smtp"

# Within our organization we care more about speed and capacity than connections
# The maxchannel value should be larger than the value used by smtp/*, to avoid
# some potential state and phase problems in the queues.
smtp/*.fi
	maxchannel=199
	maxring=20
	interval=10m
	retries="1 1 2 3 5 8 13 21 34"
	skew=1
	command="smtp -s" # -l ${LOGDIR}/smtp"

#
# These messages will go only into the queue, and need explicite
# SMTP mediated ETRN request, before they become flushed out.
#

smtp-etrn/*
	maxchannel=199
	maxring=20
	interval=1h
	retries="12"
	queueonly
	command="smtp -s -c $channel -l ${LOGDIR}/smtp-etrn"

# Connections to the outside shouldn't duplicate effort so we only allow one
# per destination.
smtp/*
	maxchannel=199
	maxring=50
	command="smtp -s" # -l ${LOGDIR}/smtp"

# Error messages.  Delivery can be retried at leisure.
error/*
	interval=5m
	idlemax=2m
	maxchannel=5
	command=errormail

# UUCP delivery.  The "sm" transport agent picks the first host it sees and
# will select further recipient addresses with that host only.  We tell
# the scheduler this with the "byhost" boolean, to avoid a staggered delivery
# effect if the scheduler has to discover this on its own.
uucp/*		maxchannel=5
		command="sm -8c $channel uucp"

# News delivery.  Hostname is always the same here.
usenet/*	maxchannel=2
		command="sm -8c $channel usenet"

# UBC EAN X.400 gateway.  See comment at UUCP.
ean/*		maxchannel=1
		command="sm -c $channel ean"

# BitBucket channel
bitbucket/*
		maxchannel=1
		command="sm -c $channel bitbucket"

smtpgw-*/*
		maxchannel=30
		maxring=30
		command="sm -8c $channel $channel"
