From zmailer-owner@nic.funet.fi Sat Dec 20 06:30:02 1997
Received: from uxmail-nc2.ust.hk ([202.40.139.41]:41957 "EHLO uxmail-nc2.ust.hk" ident: "root") by nic.funet.fi with ESMTP id <1253-625>; Sat, 20 Dec 1997 06:14:18 +0200
Received: from ccsu51.ust.hk ([143.89.103.20]:48544 "HELO ccsu51" ident: "ccyflai") by uxmail.ust.hk with SMTP id <626286-20898>; Sat, 20 Dec 1997 12:08:25 +0800
Received: by ccsu51 
        (SMI-8.6//ident-1.0) id MAA14751; Sat, 20 Dec 1997 12:08:24 +0800 
Message-ID: <19971220120824.60800@ust.hk>
Date:	Sat, 20 Dec 1997 12:08:24 +0800
From:	Lai Yiu Fai <ccyflai@ust.hk>
To:	mea@nic.funet.fi
Cc:	zmailer@nic.funet.fi
Subject: smtp dump core after stopping scheduler
Mime-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Mailer: Mutt 0.88e
Return-Path: <zmailer-owner@nic.funet.fi>
X-Orcpt: rfc822;mea
Status: RO

Hello,

The problem found in 2.99.49p9 release running on Solaris 2.5.1.  The smtp
transporter dump core after "router kill scheduler".   It is not repeatable
but happened intermittently.

It seems NULL pointer arguments are passing to the vcsetup() in makeconn().

====
# gdb /opt/zmailer/bin/ta/smtp core
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type "show copying" to see the conditions.
There is absolutely no warranty for GDB; type "show warranty" for details.
GDB 4.16 (sparc-sun-solaris2.5), 
Copyright 1996 Free Software Foundation, Inc...
Core was generated by `/opt/zmailer/bin/ta/smtp -s -l /var/log/mail/smtp'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/lib/libsocket.so.1...done.
Reading symbols from /usr/lib/libnsl.so.1...done.
Reading symbols from /usr/lib/libc.so.1...done.
Reading symbols from /usr/lib/libdl.so.1...done.
Reading symbols from /usr/lib/libintl.so.1...done.
Reading symbols from /usr/lib/libmp.so.1...done.
Reading symbols from /usr/lib/libw.so.1...done.
Reading symbols from /usr/platform/SUNW,Ultra-2/lib/libc_psr.so.1...done.
Reading symbols from /usr/lib/nss_files.so.1...done.
Reading symbols from /usr/lib/nss_compat.so.1...done.
#0  0xef66056c in memcpy ()
(gdb) bt
#0  0xef66056c in memcpy ()
#1  0xef5e0f9c in _doprnt ()
#2  0xef5eb274 in sprintf ()
#3  0x18d40 in vcsetup (SS=0x0, sa=0x0, fdp=0x0, 
    hostname=0x3a310000 <Address 0x3a310000 out of bounds>) at smtp.c:2770
#4  0x18588 in makeconn (SS=0xefffd0a0, ai=0x50590, ismx=-1) at smtp.c:2500
#5  0x18108 in smtpconn (SS=0xefffd0a0, host=0x46668 "mach.psych.indiana.edu", 
    noMX=0) at smtp.c:2315
#6  0x17820 in smtpopen (SS=0xefffd0a0, host=0x46668 "mach.psych.indiana.edu", 
    noMX=0) at smtp.c:2016
#7  0x14ecc in main (argc=-268437048, argv=0xeffff9d7) at smtp.c:914


=======================================================================
Lai Yiu Fai                       |  Tel.:       (852) 2358-6202
Centre of Computing Services      |  Fax.:       (852) 2358-0967
 & Telecommunications             |  E-mail:     ccyflai@ust.hk
                                  |
The Hong Kong University of       |  Clear Water Bay,
Science & Technology              |  Kowloon, Hong Kong.

